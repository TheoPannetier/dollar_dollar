[["index.html", "A Minimal Book Example Chapter 1 Prerequisites", " A Minimal Book Example Yihui Xie 2022-02-15 Chapter 1 Prerequisites This is a sample book written in Markdown. You can use anything that Pandoc’s Markdown supports, e.g., a math equation \\(a^2 + b^2 = c^2\\). The bookdown package can be installed from CRAN or Github: install.packages(&quot;bookdown&quot;) # or the development version # devtools::install_github(&quot;rstudio/bookdown&quot;) Remember each Rmd file contains one and only one chapter, and a chapter is defined by the first-level heading #. To compile this example to PDF, you need XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): https://yihui.org/tinytex/. "],["intro.html", "About bookdown", " About bookdown Labelling sections {#label} for a label {-} to disable section numbering {- #label} for both Reference: \\@ref(label) Referring to {- #label} section will show ??, though the link is still valid. E.g. ?? Labelling equations \\[ x + y = z \\tag{1.1} \\] And refer with \\@ref(eq:eq-label) like this (1.1) Labelling code blocks Can’t refer to code blocks directly, but can refer to figures or tables produced by them. {r label-code-block, ...} Figure: \\@ref(fig:label-code-block) Table: \\@ref(tab:label-code-block) par(mar = c(4, 4, .1, .1)) plot(pressure, type = &#39;b&#39;, pch = 19) Figure 1.1: Here is a nice figure! See Figure 1.1. knitr::kable( head(iris, 20), caption = &#39;Here is a nice table!&#39;, booktabs = TRUE ) Table 1.1: Here is a nice table! Sepal.Length Sepal.Width Petal.Length Petal.Width Species 5.1 3.5 1.4 0.2 setosa 4.9 3.0 1.4 0.2 setosa 4.7 3.2 1.3 0.2 setosa 4.6 3.1 1.5 0.2 setosa 5.0 3.6 1.4 0.2 setosa 5.4 3.9 1.7 0.4 setosa 4.6 3.4 1.4 0.3 setosa 5.0 3.4 1.5 0.2 setosa 4.4 2.9 1.4 0.2 setosa 4.9 3.1 1.5 0.1 setosa 5.4 3.7 1.5 0.2 setosa 4.8 3.4 1.6 0.2 setosa 4.8 3.0 1.4 0.1 setosa 4.3 3.0 1.1 0.1 setosa 5.8 4.0 1.2 0.2 setosa 5.7 4.4 1.5 0.4 setosa 5.4 3.9 1.3 0.4 setosa 5.1 3.5 1.4 0.3 setosa 5.7 3.8 1.7 0.3 setosa 5.1 3.8 1.5 0.3 setosa See Table 1.1 "],["phylo-bd.html", "Chapter 2 Phylogenetic birth-death models 2.1 Louca and Pennell (2020) 2.2 Morlon, Parsons, and Plotkin (2011)", " Chapter 2 Phylogenetic birth-death models Equations from the litterature to describe birth-death processes in the context of phylogenetic (time)trees. 2.1 Louca and Pennell (2020) 2.1.1 Derivation of \\(N(\\tau)\\), \\(M(\\tau)\\) and \\(E(\\tau)\\) \\(N(\\tau)\\) number of species in the tree at time \\(\\tau\\) in the past \\(M(\\tau)\\) is the dLTT = the expected (under the model) number of lineages in the tree at time \\(\\tau\\) that will be present in the tree at present \\(E(\\tau)\\) fraction of lineages in the tree at time \\(\\tau\\) that won’t be in the tree anymore at present We note: \\(\\lambda\\) and \\(\\mu\\) the birth and death rate resp., which can be time-dependent (\\(\\lambda(t)\\), \\(\\mu(t)\\)) \\(\\rho\\) the sampling fraction at present, such that \\(M_0 = N_0 \\rho\\) is the number of species sampled in the present tree (and \\(N_0\\) is the total living diversity) Going backwards in time (\\(\\tau\\) is some time before present): \\[\\begin{align} \\frac{dN}{d\\tau} &amp;= N(\\mu - \\lambda) \\\\ &amp;= N(-r) \\tag{2.1} \\end{align}\\] The solution of which is (perform a separation of variables): \\[\\begin{align} N(\\tau) &amp;= N_{0}e^{\\left[ \\int_0^\\tau \\mu(u) - \\lambda(u) du \\right]} \\tag{2.2} \\end{align}\\] i.e. the number of species alive (but not necessarily sampled in the tree) at time \\(\\tau\\) in the past. Let’s introduce \\(E(\\tau)\\), the fraction of lineages alive at time \\(\\tau\\) that won’t be included in the final tree, because of either extinction or being missing from the sample. In a stochastic setting, it is also the probability that a single lineage will be missing from the final tree. \\(E(\\tau)\\) is introduced in Morlon, Parsons, and Plotkin (2011), eqs. 5-7 (where it is named \\(\\phi(t)\\)) (see also the derivation below): \\[\\begin{align} \\frac{dE}{d\\tau} &amp;= \\mu - E (\\lambda + \\mu) + E^2\\lambda \\\\ E(0) &amp;= 1 - \\rho \\tag{2.3} \\end{align}\\] Its solution is (eq. 2 in Morlon, Parsons, and Plotkin (2011)): \\[ E(\\tau) = 1 - \\frac{e^{\\int_0^\\tau \\lambda(u) - \\mu(u) du}}{\\frac{1}{\\rho} + \\int_0^\\tau e^{\\int_0^s \\lambda(u) - \\mu(u) du} \\lambda_s ds} \\tag{2.4} \\] where \\(s\\) is some time before \\(\\tau\\), and \\(\\rho\\) is the probability that an extant lineage is sampled at present, aka sampling fraction. The deterministic LTT, i.e. the number of lineages present in the final tree, through time, is (by definition of \\(M\\) and \\(E\\)) given by: \\[ M(\\tau) = N(\\tau)(1 - E(\\tau)) \\tag{2.5} \\] Taking the derivative and replacing with (2.1) and (2.3) yields \\[ \\frac{dM}{d\\tau} = M\\lambda(E-1) \\tag{2.6} \\]Notice that \\((E - 1)\\) is most likely negative, \\(M\\) declines as we go in the past, ok. If all lineages will be included in the tree (\\(E = 0\\), which requires \\(\\mu = 0\\)), then \\(M\\) simply changes by \\(-M\\lambda\\), that is the growth rate. The solution to (2.6) (taking \\(M(0) = M_0\\) and using a separation of variables) is: \\[ M(\\tau) = M_0e^{\\int_0^\\tau \\lambda(u) (E(u) - 1) du} \\tag{2.7} \\] This equation fully describes the LTT expected given the birth-death model, aka the dLTT. Remarks All terms in this equation are independent of the data! So model congruency (sharing the same dLTT) is a property of the models alone. Extinction does not appear in (2.7), but is in fact hidden in \\(E(\\tau)\\) In (2.6), \\(0&lt;E&lt;1\\), so that the rhs is negative or zero: we move backwards in time and lose lineages in the phylogeny, proportionally to rate \\(\\lambda\\). The term \\(\\lambda(E-1)\\) (“growth” rate) can be developped into \\(\\lambda E - \\lambda\\), illustrating that we are gaining lineages that would disappear later in time, and losing those that speciate later. 2.1.2 PSR, PDR { #psr-pdr } PSR: pulled speciation rate, the relative slope of \\(M(\\tau)\\) \\(\\lambda(\\tau) = -\\frac{1}{M}\\frac{dM}{d\\tau}\\) PDR: pulled diversification rate r(0:15) ## [1] 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 2.1.3 Likelihood { #likelihood } After Morlon, Parsons, and Plotkin (2011): \\[ L = \\frac{\\rho^{n+1} \\Psi(\\tau_1, \\tau_0)}{ 1 - E(\\tau_0)}\\prod_{i = 1}^n \\lambda(\\tau_i) \\Psi(s_{i,1}, \\tau_i) \\Psi(s_{i,2}, \\tau_i) \\tag{2.8} \\] \\(n\\) branching points (\\(n+1\\) lineages at time \\(0\\)) \\(\\tau_0\\) stem age, \\(\\tau_1\\) crown age, \\(\\tau_i\\) branching points, \\(s_{i, 1}\\) , \\(s_{i, 2}\\) branching points of daughter lineages. \\(\\rho\\) sampling fraction (\\(\\rho^{n+1}\\) p that all lineages are sampled) conditioning \\(\\frac{1}{1 - E(\\tau_0)}\\) that stem lineage survives and is observed \\(\\Psi(s, \\tau)\\) p that a lineage alive at time \\(\\tau\\) has exactly one descendant at time \\(s\\) = probability of observing each branch. \\[ \\Psi(s, \\tau) = e^{R(\\tau) - R(s)} \\Big[\\frac{1 + \\rho \\int_0^s \\lambda(u) e^{R(u)} du}{1 + \\rho \\int_0^\\tau \\lambda(u) e^{R(u)} du} \\Big]^2 \\tag{2.9} \\] where \\(R(\\tau)\\) is the integral of the net diversification rate \\[ R(\\tau) = \\int_0^\\tau \\lambda(u) - \\mu(u) du \\] Because the probabilities of the branches cancel out, (2.8) simplifies to: \\[ L = \\frac{\\rho^{n+1} \\Psi(0, \\tau_0)}{ 1 - E(\\tau_0)}\\prod_{i = 1}^n \\lambda(\\tau_i) \\Psi(0, \\tau_i) \\tag{2.10} \\] using the definitions of the PSR and PDR, the likelihood can be rewritten as \\[ L = \\frac{M(\\tau_0)}{M_0^{n+1}}\\prod_{i = 1}^n \\lambda_p(\\tau_i) M(\\tau_i) \\tag{2.11} \\] which, applying the def of the PSR, turns into \\[ L = \\frac{M(\\tau_0)}{M_0^{n+1}}\\prod_{i = 1}^n -\\frac{dM}{d\\tau}|_{\\tau_{i}}\\tag{2.12} \\] (vertical bar denotes that \\(d\\tau\\) is evaluated at \\(\\tau_i\\), so the instantaneous change in \\(M\\) at this point in time) There are also variants if only the crown age, and not the stem age, is known: \\[ L_r = \\frac{\\rho^{n+1} \\Psi(0, \\tau_1)}{\\lambda(\\tau_1)[1 - E(\\tau_1)]^2}\\prod_{i = 1}^n \\lambda(\\tau_i) \\Psi(0, \\tau_i) \\tag{2.13} \\] \\[ L_r = \\frac{M^2(\\tau_1)}{M_0^{n+1}}\\prod_{i = 2}^n -\\frac{dM}{d\\tau}|_{\\tau_{i}}\\tag{2.14} \\] 2.2 Morlon, Parsons, and Plotkin (2011) Derivation of \\(E(\\tau)\\) equations \\(E(\\tau)\\) (or \\(\\Phi(t)\\) in Morlon, Parsons, and Plotkin (2011)) denotes the probability that a lineage alive at \\(\\tau\\) won’t have any descendant included in the final tree. There are three main combinations of events that can lead to a lineage not having descendants in the final tree: 1. Lineage goes extinct (with probability \\(\\mu(\\tau)\\) in a single time unit) 2. No extinction (\\(1 - \\mu(\\tau)\\)), no speciation (\\(1 - \\lambda(\\tau)\\)), lineage not observed at present (\\(E(\\tau)\\)). 3. No extinction (\\(1 - \\mu(\\tau)\\)), lineage undergoes speciation (\\(\\lambda(\\tau)\\)) but neither parent or daughter are observed at present (\\(E(\\tau) * E(\\tau)\\)). From this the following recursion can be written: \\[\\begin{align} E(\\tau + 1) &amp;= \\mu \\\\ &amp; + (1 - \\mu(\\tau))(1 - \\lambda(\\tau)) E(\\tau) \\\\ &amp; + (1 - \\mu(\\tau)) \\lambda(\\tau) E(\\tau)^2 \\\\ &amp; + o(\\tau) \\end{align}\\] More complex series of events (e.g. multiple speciation events followed by extinction or non-sampling) are assumed very unlikely to happen in the typical time intervals and rates considered; and thus ignored (\\(o(\\tau)\\). Deriving an ODE from this recursion goes as follows (see 3.1 ): \\[\\begin{align} E(\\tau + \\Delta \\tau) &amp;= \\mu\\Delta \\tau \\\\ &amp; + (1 - \\mu(\\tau)\\Delta \\tau)(1 - \\lambda(\\tau)\\Delta \\tau) E(\\tau) \\\\ &amp; + (1 - \\mu(\\tau)\\Delta \\tau) \\lambda(\\tau)\\Delta \\tau E(\\tau)^2 \\\\ E(\\tau + \\Delta \\tau) - E(\\tau) &amp;= \\mu\\Delta \\tau \\\\ &amp; - (\\lambda + \\mu + \\lambda \\mu \\Delta \\tau^2) \\Delta \\tau E(\\tau) \\\\ &amp; + (1 - \\mu(\\tau)\\Delta \\tau) \\lambda(\\tau)\\Delta \\tau E(\\tau)^2 \\\\ \\frac{E(\\tau + \\Delta \\tau) - E(\\tau)}{\\Delta\\tau} &amp;= \\mu \\\\ &amp; - (\\lambda + \\mu + \\lambda \\mu \\Delta \\tau^2) E(\\tau) \\\\ &amp; + (1 - \\mu(\\tau)\\Delta \\tau) \\lambda(\\tau) E(\\tau)^2 \\\\ \\lim_{\\Delta\\tau \\to 0} \\frac{E(\\tau + \\Delta \\tau) - E(\\tau)}{\\Delta\\tau} &amp;= \\mu \\\\ &amp; - (\\lambda + \\mu) E(\\tau) \\\\ &amp; + \\lambda(\\tau) E(\\tau)^2 \\\\ \\frac{dE}{d\\tau} &amp;= \\mu - (\\lambda + \\mu) E(\\tau) + \\lambda(\\tau) E(\\tau)^2 \\end{align}\\] Note that Morlon, Parsons, and Plotkin (2011) made a mistake in eq. 6 and forgot to multiply \\(\\lambda(t)\\) by \\(\\Delta t\\). We also now that \\(E(0) = 1 - \\rho\\). References "],["otto-day.html", "Chapter 3 Otto &amp; Day shortcuts 3.1 Derive a continuous model from a discrete model General solution of a model", " Chapter 3 Otto &amp; Day shortcuts Recipes and reading notes from Otto and Day (2007). 3.1 Derive a continuous model from a discrete model Box 2.6, p.44 in Otto and Day (2007). Consider this discrete population growth model, with birth, death and migration: \\[ n(t+1) = (1 + b)(1-d)n(t) + m \\] Shrink the length of the interval \\(t+1\\) to something smaller, \\(t+\\Delta t\\). Scale down all quantities that scale with time. \\[ n(t+\\Delta t) = (1 + b\\Delta t)(1-d\\Delta t)n(t) + m\\Delta t \\] \\(b\\), \\(d\\), and \\(m\\) are the number of births, deaths and migrants in a single time step. The number that happens during \\(t+\\Delta t\\) is a fraction \\(\\Delta t\\). Substract \\(n(t)\\) from both sides to get \\(n(\\Delta t)\\) Divide both sides by \\(\\Delta t\\). Find a way to get \\(\\Delta t\\) out of the denominator. Shrink \\(\\Delta t\\), taking the limit \\(\\lim_{\\Delta t\\to 0}\\) \\[ \\frac{dn(t)}{dt} = \\lim_{\\Delta t \\to 0} \\frac{n(t + \\Delta t) - n(t)}{\\Delta t} \\] For the above example: \\[\\begin{align} \\frac{n(t + \\Delta t) - n(t)}{\\Delta t} &amp;= \\frac{(1 + b\\Delta t)(1 - d\\Delta t) + m\\Delta t - n(t)}{\\Delta t} \\\\ &amp;= bn(t) - dn(t) + m -bdn(t)\\Delta t \\end{align}\\] The last term drops when \\(\\Delta t\\) shrinks to 0, yielding: \\[ \\frac{dn(t)}{dt} = (b - d)n(t) + m \\] General solution of a model Linear models, continuous time, single variable Recipe 3.1 (Solving Differential Equations Using a Separation of Variables) Differential equations that can be written as \\(dn/dt = f(n) g(t)\\) can be solved as follows: Define what are \\(f(n)\\) and \\(g(t)\\) \\(\\frac{1}{f(n)}dn = g(t)dt\\) \\(\\int \\frac{1}{f(n)}dn = \\int g(t)dt\\) Solve and don’t forget the constants of integration on both sides. Lump them together on one side (\\(c = c_1-c_2\\)). Set \\(t=0\\) or \\(N=0\\) to find the value of \\(c\\). Shortcut: the exponential growth model \\[\\begin{align} \\frac{dN}{dt} &amp;= rN \\\\ N(t) = N_0 e^{rt} \\end{align}\\] Checks: take the solution and derive to find the differential equation. Use \\(N_0\\) to replace the exponential term by some function of \\(N(t)\\). Example with the affine function \\(\\frac{dN}{dt} = rN + m\\) Setting \\(f(N) = rN + m\\) and \\(g(t) = 1\\). \\[ \\begin{align} \\int \\frac{1}{rN + m} dn &amp;= \\int 1 dt \\end{align} \\] I use rule A2.22 in Otto &amp; Day to solve the lhs, setting \\(a_1 = m\\), \\(b_1 = r\\), \\(a_2 = 1\\) and \\(b_2 = 0\\). \\[ \\begin{align} \\frac{1}{r} ln(|rN + m|) + cst_1 &amp;= t + cst_2 \\\\ ln(|rN + m|) &amp;= r(t + cst) \\\\ N(t) &amp;= \\frac{1}{r}(e^{r(t + cst)} - m) \\end{align} \\] Setting \\(t=0\\) to solve for the \\(cst\\) \\[ \\begin{align} N(0) &amp;= \\frac{1}{r}(e^{r cst} - m) \\\\ cst &amp;= \\frac{1}{r} ln(r N_{0} + m) \\end{align} \\] So \\[ \\begin{align} n(t) &amp;= \\frac{1}{r}\\{e^{r(t)}(rN_0 + m) - m)\\} \\\\ &amp;= N_0e^{rt} + \\frac{m}{r}e^{rt} - \\frac{m}{r} \\end{align} \\] First check: with \\(t = 0\\), I find \\(N(0) = N_0\\). Second check: deriving with respect to \\(t\\): \\[ \\begin{align} \\frac{dN}{dt} &amp;= (N_0e^{rt})&#39; + \\Big(\\frac{m}{r}e^{rt}\\Big)&#39; - \\Big(\\frac{m}{r}\\Big)&#39; \\\\ &amp;= rN_0e^{rt} + me^{rt} \\\\ &amp;= r\\Big(N_0e^{rt} + \\frac{m}{r}e^{rt}\\Big) \\\\ &amp;= r\\Big(N(t) + \\frac{m}{r}\\Big) \\\\ &amp;= rN(t) + m \\end{align} \\] References "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
